{% extends "base.html" %}
{% block title %}Vincoli — {{ timetable.class_identifier }} — Easyorario{% endblock %}
{% block content %}
<div class="container" style="--container-max: 640px;">
  <h1>Vincoli — {{ timetable.class_identifier }} ({{ timetable.school_year }})</h1>

  {% include "partials/flash_messages.html" %}

  <article class="card">
    <form method="post" action="/orario/{{ timetable.id }}/vincoli">
      {{ csrf_input | safe }}
      <label data-field>
        Nuovo vincolo
        <textarea name="text" rows="3" maxlength="1000" minlength="1" required
                  placeholder="Es: Prof. Rossi non può insegnare il lunedì mattina"></textarea>
      </label>
      <button type="submit" class="w-100">Aggiungi vincolo</button>
    </form>
  </article>

  {% if constraints %}
  <section>
    <h2>Vincoli inseriti</h2>
    {% for constraint in constraints %}
    <article class="card">
      <p>
        {% if constraint.status == "pending" %}
        <span class="badge">in attesa</span>
        {% elif constraint.status == "translated" %}
        <span class="badge warning">tradotto</span>
        {% elif constraint.status == "translation_failed" %}
        <span class="badge danger">errore traduzione</span>
        {% elif constraint.status == "verified" %}
        <span class="badge success">verificato</span>
        {% elif constraint.status == "rejected" %}
        <span class="badge danger">rifiutato</span>
        {% endif %}
        {{ constraint.natural_language_text }}
      </p>
    </article>
    {% endfor %}
  </section>

  {% if has_pending or has_failed %}
  <form method="post" action="/orario/{{ timetable.id }}/vincoli/verifica">
    {{ csrf_input | safe }}
    {% if has_pending %}
    <button type="submit" class="w-100 outline">Verifica vincoli</button>
    {% else %}
    <button type="submit" class="w-100 outline">Riprova traduzione</button>
    {% endif %}
  </form>
  {% endif %}

  {% else %}
  <p class="text-lighter">Nessun vincolo inserito.</p>
  {% endif %}
</div>
{% endblock %}
